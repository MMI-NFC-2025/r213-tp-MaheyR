---
export const prerender = false;

import Layout from "../../../layouts/Layout.astro";
import OffreCard from "../../../components/OffreCard.astro";
import { getOffres } from "../../../backend.mjs";

const { prix } = Astro.params;
const prixMax = Number(prix);

if (Number.isNaN(prixMax)) {
  return Astro.redirect("/offres");
}

const offres = await getOffres();
const offresFiltrees = offres.filter((o) => Number(o.prix) < prixMax);
---

<Layout titre={`Offres < ${prixMax} €`}>
  <h1 class="text-2xl font-bold">Maisons à moins de {prixMax} €</h1>

  <p class="mt-2 text-gray-600">
    Résultats : {offresFiltrees.length}
  </p>

  <div class="mt-6 space-y-4">
    {offresFiltrees.map((offre) => <OffreCard offre={offre} />)}
  </div>

  <a class="underline inline-block mt-6" href="/offres">← Retour aux offres</a>
</Layout>
